
<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>칒konomisk Styringscenter</title>
  <style>
    /* --- CSS STYLING --- */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 950px;
      margin: 0 auto;
    }

    h1, h2, h3 { color: #2c3e50; text-align: center; }
    
    /* Kort-design */
    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 30px;
      margin-bottom: 25px;
      transition: all 0.3s ease;
    }

    /* Datatabel styling */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.9em;
    }
    .data-table th, .data-table td {
      border: 1px solid #e0e0e0;
      padding: 8px;
      text-align: center;
    }
    .data-table th {
      background-color: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }
    .data-table tr:nth-child(even) {
      background-color: #fcfcfc;
    }
    .data-table td:first-child {
      text-align: left;
      font-weight: 500;
    }

    /* Kontrolpanel */
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      align-items: center;
      background: #34495e;
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    select {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #bdc3c7;
      min-width: 200px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
      background-color: #27ae60;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s;
    }
    button:hover { background-color: #2ecc71; }
    button:disabled { background-color: #95a5a6; cursor: not-allowed; }

    /* Trin-indikator */
    .step-nav {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .step-item {
      flex: 1;
      text-align: center;
      background: #e0e0e0;
      padding: 10px;
      font-weight: bold;
      color: #7f8c8d;
      border-right: 1px solid white;
    }
    .step-item:first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
    .step-item:last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; border: none; }
    .step-item.active { background: #3498db; color: white; }
    .step-item.completed { background: #27ae60; color: white; }

    /* Trin 1: Layout */
    .balance-wrapper {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    @media (max-width: 700px) { .balance-wrapper { flex-direction: column; } }
    
    .balance-col {
      flex: 1;
      background: #f9f9f9;
      padding: 20px;
      border: 2px dashed #bdc3c7;
      border-radius: 8px;
    }
    .balance-col.left-side { border-color: #3498db; }
    .balance-col.right-side { border-color: #e67e22; }

    .input-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .input-row label { font-size: 0.9em; font-weight: 600; }
    .input-row input { 
      width: 100px; 
      padding: 6px; 
      text-align: right; 
      border: 1px solid #ccc; 
      border-radius: 4px;
    }

    /* Trin 2 Specifik Styling */
    .calc-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .calc-table th { text-align: left; background: #eee; padding: 10px; }
    .calc-table td { padding: 10px; border-bottom: 1px solid #eee; }
    .calc-input { width: 80px; padding: 5px; text-align: center; border: 1px solid #ccc; border-radius:4px; }

    .info-box {
      background: #e8f6f3;
      border-left: 5px solid #1abc9c;
      padding: 15px;
      margin: 15px 0;
      font-size: 0.95em;
    }

    /* Feedback bokse */
    .feedback {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      display: none; 
      text-align: center;
    }
    .feedback.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .feedback.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }

    /* Trin 3: Tabel og Knapper */
    .analysis-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .analysis-table th, .analysis-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }
    .analysis-table th { background-color: #f2f2f2; }
    
    .btn-group {
      display: flex;
      gap: 5px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .btn-option {
      background: #ecf0f1;
      color: #333;
      border: 1px solid #bdc3c7;
      font-size: 0.8em;
      padding: 6px 5px;
      cursor: pointer;
      border-radius: 4px;
      flex: 1;
      min-width: 60px;
    }
    .btn-option:hover { background: #dfe6e9; }
    .btn-option.selected {
      background: #2c3e50;
      color: white;
      border-color: #2c3e50;
    }

    /* Victory Screen */
    .victory-container { text-align: center; padding: 40px; }
    .victory-icon { font-size: 4em; color: #27ae60; margin-bottom: 20px; }

    .hidden { display: none; }
  </style>
</head>
<body>

<div class="container">
  
  <div class="card controls">
    <div>
      <label for="countrySelect" style="font-weight:bold; margin-right:10px;">V칝lg land:</label>
      <select id="countrySelect">
        <option value="" disabled selected>-- Indl칝s data --</option>
      </select>
    </div>
    <button onclick="initGame()">Start Spillet</button>
  </div>

  <div id="gameArea" class="hidden">
    
    <div class="card">
      <h3>Datakilde: <span id="dataCountryName"></span></h3>
      <p style="text-align:center; font-size:0.9em; margin-bottom:15px;">Brug tallene herunder til at l칮se opgaverne.</p>
      <div id="dataTableContainer"></div>
    </div>

   <div class="step-nav">
      <div id="nav1" class="step-item active">1. Opstilling</div>
      <div id="nav2" class="step-item">2. V칝gtning</div>
      <div id="nav3" class="step-item">3. Analyse</div>
      <div id="nav4" class="step-item">4. Kausalitet</div>
    </div>
<div id="step4" class="card hidden">
  <h2>Trin 4: Kausalk칝der & 칒konomisk Sammenh칝ng</h2>
  
  <div id="s4_part1">
    <h3>Del 1: Landets 칒konomiske Situation (2024)</h3>
    <p class="info-box">
      <strong>Opgave:</strong> BNP-v칝ksten i 2024 er <strong style="color:#2980b9; font-size:1.2em;"><span class="bnp-display"></span></strong>.<br>
      Vurder ud fra dette tal, hvilken konjunktursituation landet befinder sig i.
    </p>
    
    <div style="text-align:center; margin-bottom:15px;">
      <select id="s4_situationSelect" style="padding:8px;">
        <option value="" disabled selected>-- V칝lg situation --</option>
        <option value="krise">칒konomisk krise (Negativ/lav v칝kst i flere 친r)</option>
        <option value="lav">Lavkonjunktur (Under 1% v칝kst)</option>
        <option value="stabil">Stabil 칮konomisk udvikling (1% - 2% v칝kst)</option>
        <option value="h칮j">H칮jkonjunktur (Over 2% v칝kst)</option>
        <option value="overophedning">Mod en overophedning (Over 2% i flere 친r)</option>
      </select>
    </div>
    
    <div id="fb4_1" class="feedback"></div>
    <div style="text-align:center;">
      <button onclick="checkStep4_Part1()">Tjek Situation</button>
    </div>
  </div>

  <div id="s4_part2" class="hidden" style="margin-top:30px; border-top:2px dashed #ccc; padding-top:20px;">
    <h3>Del 2: M친ls칝tning om V칝kst</h3>
    <p class="info-box">
      Opfylder landet det samfunds칮konomiske m친l om 칮konomisk v칝kst i 2024? <br>
      Du skal b친de svare Ja/Nej og angive den korrekte begrundelse.
    </p>
    
    <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap; margin-bottom:15px;">
      <select id="s4_goalSelect" style="padding:8px;">
        <option value="" disabled selected>-- Opfyldt? --</option>
        <option value="yes">Ja, m친let er opfyldt</option>
        <option value="no">Nej, m친let er ikke opfyldt</option>
      </select>

      <select id="s4_goalReason" style="padding:8px;">
        <option value="" disabled selected>-- V칝lg begrundelse --</option>
        <option value="low">Fordi v칝ksten er under 1%</option>
        <option value="high">Fordi v칝ksten er 1% eller derover</option>
        <option value="inflation">Fordi inflationen er lav (under 2%)</option>
      </select>
    </div>

    <div id="fb4_2" class="feedback"></div>
    <div style="text-align:center;">
      <button onclick="checkStep4_Part2()">Tjek M친ls칝tning</button>
    </div>
  </div>

  <div id="s4_part3" class="hidden" style="margin-top:30px; border-top:2px dashed #ccc; padding-top:20px;">
    <h3>Del 3: 칀rsager til udviklingen</h3>
    <p class="info-box">
      <strong>Opgave:</strong> Herunder ser du de 4 komponenter. Kortene er neutrale.<br>
      Din opgave er at afl칝se v칝ksten i % og v칝lge den tekst og kausalk칝de, der passer til udviklingen.
    </p>

    <div id="causalBuilderContainer"></div>

    <div id="fb4_3" class="feedback"></div>
    <div style="text-align:center; margin-top:20px;">
      <button onclick="checkStep4_Part3()">Tjek Kausalk칝der</button>
    </div>
  </div>
</div>
    <div id="step1" class="card">
      <h2>Trin 1: Forsyningsbalancen (2021)</h2>
      <p class="info-box">
        <strong>Opgave:</strong> Indtast tallene for basis친ret <strong>2021</strong>. 
        Du skal placere <em>Lager칝ndringer</em> p친 den korrekte side for at skabe ligev칝gt mellem Udbud og Eftersp칮rgsel.
      </p>

      <div class="balance-wrapper">
        <div class="balance-col left-side">
          <h3>Venstreside (Tilgang)</h3>
          <p style="text-align:center; color:#7f8c8d; font-size:0.9em;">BNP (Y) + Import (M)</p>
          <div id="containerLeft"></div>
          <div style="margin-top:10px; text-align:right; font-weight:bold;">I alt: <span id="sumLeft">0</span></div>
        </div>

        <div class="balance-col right-side">
          <h3>H칮jreside (Anvendelse)</h3>
          <p style="text-align:center; color:#7f8c8d; font-size:0.9em;">Privat forbrug (Cpr) + Off. forbrug (Coff) + I + X</p>
          <div id="containerRight"></div>
          <div style="margin-top:10px; text-align:right; font-weight:bold;">I alt: <span id="sumRight">0</span></div>
        </div>
      </div>

      <div id="fb1" class="feedback"></div>

      <div style="text-align:center; margin-top:20px;">
        <button onclick="checkStep1()">Tjek Balance</button>
        <button id="btnNext1" onclick="showStep(2)" disabled style="margin-left:10px;">G친 til Trin 2 &rarr;</button>
      </div>
    </div>

    <div id="step2" class="card hidden">
      <h2>Trin 2: V칝gtning (Andel af BNP)</h2>
      <p class="info-box">
        <strong>Opgave:</strong> Beregn andelen i % for <strong>alle fire</strong> eftersp칮rgselskomponenter baseret p친 <strong>2021-tallene</strong>.
        <br>Dette er afg칮rende for at forst친, hvor stor betydning en procentvis 칝ndring har for den samlede 칮konomi.
      </p>

      <div style="text-align:center; margin-bottom:20px;">
        <strong>BNP (2021):</strong> <span id="step2BNP" style="font-size:1.2em; color:#2c3e50; font-weight:bold;"></span> <span class="currency"></span>
      </div>

      <table class="calc-table">
        <thead>
          <tr>
            <th>Komponent</th>
            <th>V칝rdi (2021)</th>
            <th>Din Beregning (%)</th>
          </tr>
        </thead>
        <tbody id="calcBody">
          </tbody>
      </table>
      
      <p style="text-align:center; font-size:0.9em; color:#7f8c8d; margin-top:15px;">Formel: Eftersp칮rgselskomponent / BNP * 100</p>

      <div id="fb2" class="feedback"></div>

      <div style="text-align:center; margin-top:20px;">
        <button onclick="checkStep2()">Tjek Alle Svar</button>
        <button id="btnNext2" onclick="showStep(3)" disabled style="margin-left:10px;">G친 til Trin 3 &rarr;</button>
      </div>
    </div>

    <div id="step3" class="card hidden">
      <h2>Trin 3: V칝kstbidrag (Analyse 2024)</h2>
      <p class="info-box">
        <strong>Opgave:</strong> Analyser tallene for <strong>2024</strong>. 
        Vurder hver komponents bidrag til BNP-v칝ksten. Husk: En komponent kan godt have et mindre positivt bidrag, selvom den ikke tr칝kker BNP-v칝ksten "Positiv" (stiger mere end BNP).
      </p>

      <div style="text-align:center; font-size:1.2em; margin-bottom:15px;">
        V칝kst i BNP (2024): <strong style="color:#2980b9;"><span id="growthBNP"></span>%</strong>
      </div>

      <table class="analysis-table">
        <thead>
          <tr>
            <th>Komponent</th>
            <th>V칝kst i 2024 (%)</th>
            <th style="min-width:320px;">Din Vurdering</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          </tbody>
      </table>

      <div class="info-box" style="margin-top:20px; font-size:0.9em; line-height:1.6;">
        <strong>Kategorisering i analysen:</strong>
        <ul style="margin-top:5px; padding-left:20px;">
          <li><strong>Positivt:</strong> Komponenten stiger procentvis <em>mere</em> end BNP og tr칝kker gennemsnittet op.</li>
          <li><strong>Neutralt:</strong> Komponenten stiger med <em>samme</em> takt som BNP.</li>
          <li><strong>Mindre bidrag:</strong> Komponenten stiger (er over 0%), og bidrager derfor positivt til produktionen, men v칝ksten er lavere end BNP-snittet.</li>
          <li><strong>Negativt:</strong> Tallet er negativt (falder). Dette tr칝kker BNP direkte ned.</li>
        </ul>
      </div>

      <div id="fb3" class="feedback"></div>

      <div style="text-align:center; margin-top:20px;">
        <button onclick="checkStep3()">Afslut Analyse</button>
      </div>
    </div>
    <div id="victoryScreen" class="card hidden victory-container">
      <div class="victory-icon">游끥</div>
      <h2>Analyse Gennemf칮rt!</h2>
      <p>Du har succesfuldt analyseret <strong><span id="finalCountryName"></span></strong>.</p>
      <p>Du har styr p친:</p>
      <ul style="display:inline-block; text-align:left;">
        <li>Forsyningsbalancens ligev칝gt</li>
        <li>Komponenternes v칝gtning i 칮konomien</li>
        <li>Forskellen p친 Positivt, neutralt, negativt og mindre bidrag</li>
      </ul>
      <div style="margin-top:30px;">
        <button onclick="location.reload()">Start ny analyse</button>
      </div>
    </div>

  </div>
</div>

<script>
// --- KOMPLET DATAS칁T ---
const allData = {
    'ARG': { name: 'Argentina', currency: 'ARS mia.', data: { 'BNP i markedspriser': {2021: 46219.1, 2024: -1.7}, 'Privat forbrug': {2021: 29096.4, 2024: -4.2}, 'Offentligt forbrug': {2021: 7356.1, 2024: -3.2}, 'Investeringer': {2021: 7991.6, 2024: -17.4}, 'Lager칝ndringer': {2021: 363.1, 2024: -1.9}, 'Eksport': {2021: 8350.3, 2024: 23.2}, 'Import': {2021: 6938.4, 2024: -10.6} } },
    'AUS': { name: 'Australien', currency: 'AUD mia.', data: { 'BNP i markedspriser': {2021: 2202.7, 2024: 1.1}, 'Privat forbrug': {2021: 1089.8, 2024: 0.6}, 'Offentligt forbrug': {2021: 488.2, 2024: 4.7}, 'Investeringer': {2021: 509.6, 2024: 2.2}, 'Lager칝ndringer': {2021: 6.2, 2024: 0.1}, 'Eksport': {2021: 519.8, 2024: 1.0}, 'Import': {2021: 410.9, 2024: 5.5} } },
    'AUT': { name: '칒strig', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 406.1, 2024: -1.3}, 'Privat forbrug': {2021: 201.3, 2024: 0.1}, 'Offentligt forbrug': {2021: 88.6, 2024: 1.6}, 'Investeringer': {2021: 105.5, 2024: -3.6}, 'Lager칝ndringer': {2021: 6.6, 2024: -1.0}, 'Eksport': {2021: 227.7, 2024: -4.3}, 'Import': {2021: 223.7, 2024: -5.0} } },
    'BEL': { name: 'Belgien', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 506.0, 2024: 1.0}, 'Privat forbrug': {2021: 252.6, 2024: 2.0}, 'Offentligt forbrug': {2021: 120.3, 2024: 2.6}, 'Investeringer': {2021: 121.0, 2024: 1.4}, 'Lager칝ndringer': {2021: 2.7, 2024: -1.1}, 'Eksport': {2021: 453.5, 2024: -3.4}, 'Import': {2021: 444.1, 2024: -3.5} } },
    'BRA': { name: 'Brasilien', currency: 'BRL mia.', data: { 'BNP i markedspriser': {2021: 9012.1, 2024: 3.4}, 'Privat forbrug': {2021: 5530.6, 2024: 4.8}, 'Offentligt forbrug': {2021: 1671.5, 2024: 1.9}, 'Investeringer': {2021: 1614.8, 2024: 7.2}, 'Lager칝ndringer': {2021: 144.6, 2024: 0.5}, 'Eksport': {2021: 1722.2, 2024: 2.1}, 'Import': {2021: 1671.5, 2024: 13.2} } },
    'BGR': { name: 'Bulgarien', currency: 'BGN mia.', data: { 'BNP i markedspriser': {2021: 139.6, 2024: 2.8}, 'Privat forbrug': {2021: 80.9, 2024: 4.2}, 'Offentligt forbrug': {2021: 26.4, 2024: 4.6}, 'Investeringer': {2021: 22.7, 2024: -1.1}, 'Lager칝ndringer': {2021: 6.2, 2024: 1.0}, 'Eksport': {2021: 86.3, 2024: -0.8}, 'Import': {2021: 82.8, 2024: 1.3} } },
    'CAN': { name: 'Canada', currency: 'CAD mia.', data: { 'BNP i markedspriser': {2021: 2535.8, 2024: 1.5}, 'Privat forbrug': {2021: 1373.5, 2024: 2.4}, 'Offentligt forbrug': {2021: 543.0, 2024: 3.2}, 'Investeringer': {2021: 603.3, 2024: 0.1}, 'Lager칝ndringer': {2021: 13.5, 2024: -0.5}, 'Eksport': {2021: 790.5, 2024: 0.6}, 'Import': {2021: 787.9, 2024: 0.6} } },
    'CHL': { name: 'Chile', currency: 'CLP mia.', data: { 'BNP i markedspriser': {2021: 239416.5, 2024: 2.4}, 'Privat forbrug': {2021: 148569.9, 2024: 1.0}, 'Offentligt forbrug': {2021: 35095.4, 2024: 3.2}, 'Investeringer': {2021: 55674.7, 2024: -1.8}, 'Lager칝ndringer': {2021: 1879.2, 2024: 0.5}, 'Eksport': {2021: 76507.6, 2024: 6.2}, 'Import': {2021: 78310.3, 2024: 1.9} } },
    'CHN': { name: 'Kina', currency: 'CNY trillion', data: { 'BNP i markedspriser': {2021: 117.4, 2024: 5.0}, 'Eksport': {2021: 22.9, 2024: 16.8}, 'Import': {2021: 20.0, 2024: 5.0} } },
    'COL': { name: 'Colombia', currency: 'COP trillion', data: { 'BNP i markedspriser': {2021: 1192.6, 2024: 1.6}, 'Privat forbrug': {2021: 867.1, 2024: 1.6}, 'Offentligt forbrug': {2021: 191.4, 2024: 0.7}, 'Investeringer': {2021: 226.5, 2024: 3.2}, 'Lager칝ndringer': {2021: -0.9, 2024: 0.3}, 'Eksport': {2021: 193.2, 2024: 2.5}, 'Import': {2021: 284.6, 2024: 4.4} } },
    'CRI': { name: 'Costa Rica', currency: 'CRC trillion', data: { 'BNP i markedspriser': {2021: 40.3, 2024: 4.3}, 'Privat forbrug': {2021: 25.5, 2024: 4.0}, 'Offentligt forbrug': {2021: 6.7, 2024: 0.7}, 'Investeringer': {2021: 6.8, 2024: 4.3}, 'Lager칝ndringer': {2021: 0.7, 2024: 0.7}, 'Eksport': {2021: 14.6, 2024: 5.8}, 'Import': {2021: 14.0, 2024: 6.0} } },
    'CZE': { name: 'Tjekkiet', currency: 'CZK mia.', data: { 'BNP i markedspriser': {2021: 6306.1, 2024: 1.0}, 'Privat forbrug': {2021: 2979.5, 2024: 2.1}, 'Offentligt forbrug': {2021: 1318.7, 2024: 3.3}, 'Investeringer': {2021: 1654.3, 2024: -1.4}, 'Lager칝ndringer': {2021: 119.4, 2024: -0.9}, 'Eksport': {2021: 4446.9, 2024: 1.5}, 'Import': {2021: 4212.7, 2024: 0.7} } },
    'DNK': { name: 'Danmark', currency: 'DKK mia.', data: { 'BNP i markedspriser': {2021: 2567.5, 2024: 3.7}, 'Privat forbrug': {2021: 1187.9, 2024: 0.9}, 'Offentligt forbrug': {2021: 613.5, 2024: 1.4}, 'Investeringer': {2021: 578.3, 2024: 2.7}, 'Lager칝ndringer': {2021: 27.7, 2024: -1.0}, 'Eksport': {2021: 1510.4, 2024: 7.5}, 'Import': {2021: 1350.2, 2024: 3.0} } },
    'EST': { name: 'Estland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 31.4, 2024: -0.2}, 'Privat forbrug': {2021: 15.8, 2024: 0.0}, 'Offentligt forbrug': {2021: 6.3, 2024: 0.4}, 'Investeringer': {2021: 9.1, 2024: -6.7}, 'Lager칝ndringer': {2021: 0.6, 2024: 1.2}, 'Eksport': {2021: 25.0, 2024: -1.1}, 'Import': {2021: 25.4, 2024: -0.1} } },
    'FIN': { name: 'Finland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 248.8, 2024: -0.1}, 'Privat forbrug': {2021: 125.3, 2024: -0.1}, 'Offentligt forbrug': {2021: 61.7, 2024: 0.7}, 'Investeringer': {2021: 60.7, 2024: -7.1}, 'Lager칝ndringer': {2021: 0.9, 2024: 0.6}, 'Eksport': {2021: 99.3, 2024: 0.1}, 'Import': {2021: 99.2, 2024: -2.4} } },
    'FRA': { name: 'Frankrig', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 2505.6, 2024: 1.1}, 'Privat forbrug': {2021: 1324.9, 2024: 0.9}, 'Offentligt forbrug': {2021: 625.0, 2024: 1.7}, 'Investeringer': {2021: 587.6, 2024: -1.4}, 'Lager칝ndringer': {2021: -2.0, 2024: -0.5}, 'Eksport': {2021: 782.7, 2024: 1.6}, 'Import': {2021: 812.6, 2024: -1.2} } },
    'DEU': { name: 'Tyskland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 3667.3, 2024: -0.2}, 'Privat forbrug': {2021: 1837.5, 2024: 0.2}, 'Offentligt forbrug': {2021: 820.2, 2024: 3.2}, 'Investeringer': {2021: 774.6, 2024: -2.5}, 'Lager칝ndringer': {2021: 48.2, 2024: 0.0}, 'Eksport': {2021: 1558.8, 2024: -1.7}, 'Import': {2021: 1371.9, 2024: -0.6} } },
    'GRC': { name: 'Gr칝kenland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 184.6, 2024: 2.3}, 'Privat forbrug': {2021: 126.3, 2024: 2.1}, 'Offentligt forbrug': {2021: 39.8, 2024: -4.1}, 'Investeringer': {2021: 25.5, 2024: 4.5}, 'Lager칝ndringer': {2021: 6.8, 2024: 3.2}, 'Eksport': {2021: 74.3, 2024: 1.0}, 'Import': {2021: 88.1, 2024: 5.5} } },
    'HUN': { name: 'Ungarn', currency: 'HUF mia.', data: { 'BNP i markedspriser': {2021: 55560.5, 2024: 0.5}, 'Privat forbrug': {2021: 26761.3, 2024: 5.1}, 'Offentligt forbrug': {2021: 11552.0, 2024: -4.6}, 'Investeringer': {2021: 15144.2, 2024: -11.1}, 'Lager칝ndringer': {2021: 2041.0, 2024: 1.2}, 'Eksport': {2021: 44126.5, 2024: -3.0}, 'Import': {2021: 44064.5, 2024: -4.0} } },
    'ISL': { name: 'Island', currency: 'ISK mia.', data: { 'BNP i markedspriser': {2021: 3272.5, 2024: 0.5}, 'Privat forbrug': {2021: 1687.1, 2024: 0.6}, 'Offentligt forbrug': {2021: 896.6, 2024: 2.5}, 'Investeringer': {2021: 747.9, 2024: 7.5}, 'Lager칝ndringer': {2021: 4.7, 2024: -0.4}, 'Eksport': {2021: 1222.4, 2024: -1.2}, 'Import': {2021: 1286.1, 2024: 2.7} } },
    'IND': { name: 'Indien', currency: 'INR trillion', data: { 'BNP i markedspriser': {2021: 236.0, 2024: 6.2}, 'Privat forbrug': {2021: 143.8, 2024: 6.5}, 'Offentligt forbrug': {2021: 24.7, 2024: 4.2}, 'Investeringer': {2021: 69.8, 2024: 6.1}, 'Lager칝ndringer': {2021: 3.8, 2024: 0.0}, 'Eksport': {2021: 50.5, 2024: 6.4}, 'Import': {2021: 56.7, 2024: -0.9} } },
    'IDN': { name: 'Indonesien', currency: 'IDR trillion', data: { 'BNP i markedspriser': {2021: 16976.8, 2024: 5.0}, 'Privat forbrug': {2021: 9444.0, 2024: 5.1}, 'Offentligt forbrug': {2021: 1569.8, 2024: 6.6}, 'Investeringer': {2021: 5227.9, 2024: 4.6}, 'Lager칝ndringer': {2021: 288.9, 2024: 0.4}, 'Eksport': {2021: 3635.8, 2024: 6.5}, 'Import': {2021: 3189.6, 2024: 7.9} } },
    'IRL': { name: 'Irland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 448.1, 2024: 1.2}, 'Privat forbrug': {2021: 105.4, 2024: 2.3}, 'Offentligt forbrug': {2021: 52.6, 2024: 4.2}, 'Investeringer': {2021: 98.8, 2024: -25.8}, 'Lager칝ndringer': {2021: 5.1, 2024: -3.1}, 'Eksport': {2021: 597.0, 2024: 11.9}, 'Import': {2021: 410.8, 2024: 6.5} } },
    'ISR': { name: 'Israel', currency: 'NIS mia.', data: { 'BNP i markedspriser': {2021: 1582.3, 2024: 1.0}, 'Privat forbrug': {2021: 778.8, 2024: 3.7}, 'Offentligt forbrug': {2021: 350.5, 2024: 13.8}, 'Investeringer': {2021: 376.2, 2024: -6.4}, 'Lager칝ndringer': {2021: 33.3, 2024: -1.0}, 'Eksport': {2021: 456.1, 2024: -4.9}, 'Import': {2021: 412.6, 2024: -0.4} } },
    'ITA': { name: 'Italien', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 1842.5, 2024: 0.7}, 'Privat forbrug': {2021: 1037.7, 2024: 0.4}, 'Offentligt forbrug': {2021: 361.8, 2024: 1.1}, 'Investeringer': {2021: 382.7, 2024: 0.5}, 'Lager칝ndringer': {2021: 22.7, 2024: -0.2}, 'Eksport': {2021: 574.3, 2024: 0.4}, 'Import': {2021: 536.7, 2024: -0.7} } },
    'JPN': { name: 'Japan', currency: 'JPY trillion', data: { 'BNP i markedspriser': {2021: 553.1, 2024: 0.2}, 'Privat forbrug': {2021: 295.6, 2024: 0.0}, 'Offentligt forbrug': {2021: 117.5, 2024: 0.9}, 'Investeringer': {2021: 141.3, 2024: 0.3}, 'Lager칝ndringer': {2021: 1.5, 2024: -0.1}, 'Eksport': {2021: 100.2, 2024: 1.1}, 'Import': {2021: 103.0, 2024: 1.0} } },
    'KOR': { name: 'Sydkorea', currency: 'KRW trillion', data: { 'BNP i markedspriser': {2021: 2221.9, 2024: 2.1}, 'Privat forbrug': {2021: 1046.8, 2024: 1.1}, 'Offentligt forbrug': {2021: 378.3, 2024: 1.8}, 'Investeringer': {2021: 699.6, 2024: -0.7}, 'Lager칝ndringer': {2021: 22.3, 2024: -0.5}, 'Eksport': {2021: 874.1, 2024: 7.1}, 'Import': {2021: 799.2, 2024: 2.5} } },
    'LVA': { name: 'Letland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 32.3, 2024: -0.4}, 'Privat forbrug': {2021: 18.0, 2024: 0.5}, 'Offentligt forbrug': {2021: 7.0, 2024: 7.6}, 'Investeringer': {2021: 7.4, 2024: -6.7}, 'Lager칝ndringer': {2021: 0.9, 2024: -0.7}, 'Eksport': {2021: 21.6, 2024: -1.6}, 'Import': {2021: 22.6, 2024: -2.3} } },
    'LTU': { name: 'Litauen', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 56.7, 2024: 2.8}, 'Privat forbrug': {2021: 31.9, 2024: 3.5}, 'Offentligt forbrug': {2021: 9.9, 2024: 1.4}, 'Investeringer': {2021: 12.7, 2024: -1.3}, 'Lager칝ndringer': {2021: -0.4, 2024: 1.0}, 'Eksport': {2021: 45.1, 2024: 2.1}, 'Import': {2021: 42.6, 2024: 2.4} } },
    'LUX': { name: 'Luxembourg', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 72.9, 2024: 1.0}, 'Privat forbrug': {2021: 22.1, 2024: 1.3}, 'Offentligt forbrug': {2021: 12.5, 2024: 4.1}, 'Investeringer': {2021: 13.2, 2024: -7.2}, 'Lager칝ndringer': {2021: 0.9, 2024: -0.2}, 'Eksport': {2021: 157.0, 2024: 0.3}, 'Import': {2021: 132.8, 2024: -0.3} } },
    'MEX': { name: 'Mexico', currency: 'MXN mia.', data: { 'BNP i markedspriser': {2021: 26690.0, 2024: 1.5}, 'Privat forbrug': {2021: 18236.2, 2024: 2.8}, 'Offentligt forbrug': {2021: 3043.9, 2024: 1.6}, 'Investeringer': {2021: 5687.6, 2024: 3.3}, 'Lager칝ndringer': {2021: 237.7, 2024: 0.0}, 'Eksport': {2021: 10827.9, 2024: 3.3}, 'Import': {2021: 11343.3, 2024: 2.7} } },
    'NLD': { name: 'Holland', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 891.3, 2024: 1.0}, 'Privat forbrug': {2021: 380.4, 2024: 1.0}, 'Offentligt forbrug': {2021: 226.1, 2024: 3.6}, 'Investeringer': {2021: 184.6, 2024: -0.5}, 'Lager칝ndringer': {2021: 13.6, 2024: -0.4}, 'Eksport': {2021: 769.3, 2024: 0.1}, 'Import': {2021: 682.7, 2024: 0.0} } },
    'NZL': { name: 'New Zealand', currency: 'NZD mia.', data: { 'BNP i markedspriser': {2021: 359.1, 2024: -0.1}, 'Privat forbrug': {2021: 202.9, 2024: 0.2}, 'Offentligt forbrug': {2021: 73.4, 2024: 0.0}, 'Investeringer': {2021: 85.7, 2024: -4.6}, 'Lager칝ndringer': {2021: 8.7, 2024: 0.2}, 'Eksport': {2021: 77.7, 2024: 4.2}, 'Import': {2021: 89.4, 2024: 2.4} } },
    'NOR': { name: 'Norge', currency: 'NOK mia.', data: { 'BNP i markedspriser': {2021: 4323.9, 2024: 2.1}, 'Privat forbrug': {2021: 1626.3, 2024: 1.2}, 'Offentligt forbrug': {2021: 970.7, 2024: 2.4}, 'Investeringer': {2021: 992.2, 2024: -1.9}, 'Lager칝ndringer': {2021: 92.6, 2024: -0.7}, 'Eksport': {2021: 1860.9, 2024: 5.7}, 'Import': {2021: 1218.8, 2024: 3.7} } },
    'POL': { name: 'Polen', currency: 'PLN mia.', data: { 'BNP i markedspriser': {2021: 2660.5, 2024: 2.9}, 'Privat forbrug': {2021: 1504.5, 2024: 3.0}, 'Offentligt forbrug': {2021: 490.1, 2024: 7.6}, 'Investeringer': {2021: 455.7, 2024: -0.1}, 'Lager칝ndringer': {2021: 121.9, 2024: 0.3}, 'Eksport': {2021: 1518.8, 2024: 2.0}, 'Import': {2021: 1430.5, 2024: 4.2} } },
    'PRT': { name: 'Portugal', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 216.5, 2024: 1.9}, 'Privat forbrug': {2021: 137.1, 2024: 3.2}, 'Offentligt forbrug': {2021: 40.1, 2024: 1.1}, 'Investeringer': {2021: 44.4, 2024: 3.0}, 'Lager칝ndringer': {2021: 0.9, 2024: -0.1}, 'Eksport': {2021: 89.9, 2024: 3.4}, 'Import': {2021: 96.0, 2024: 4.9} } },
    'SVK': { name: 'Slovakiet', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 101.9, 2024: 2.1}, 'Privat forbrug': {2021: 57.6, 2024: 2.8}, 'Offentligt forbrug': {2021: 21.6, 2024: 3.7}, 'Investeringer': {2021: 20.0, 2024: 1.8}, 'Lager칝ndringer': {2021: 3.2, 2024: 0.9}, 'Eksport': {2021: 92.2, 2024: -0.2}, 'Import': {2021: 92.6, 2024: 1.5} } },
    'SVN': { name: 'Slovenien', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 52.0, 2024: 1.6}, 'Privat forbrug': {2021: 26.8, 2024: 1.6}, 'Offentligt forbrug': {2021: 10.8, 2024: 8.5}, 'Investeringer': {2021: 10.5, 2024: -3.7}, 'Lager칝ndringer': {2021: 0.8, 2024: 0.3}, 'Eksport': {2021: 43.7, 2024: 3.2}, 'Import': {2021: 40.6, 2024: 3.9} } },
    'ESP': { name: 'Spanien', currency: 'EUR mia.', data: { 'BNP i markedspriser': {2021: 1235.5, 2024: 3.2}, 'Privat forbrug': {2021: 693.6, 2024: 2.9}, 'Offentligt forbrug': {2021: 259.4, 2024: 4.1}, 'Investeringer': {2021: 249.6, 2024: 3.0}, 'Lager칝ndringer': {2021: 20.7, 2024: -0.2}, 'Eksport': {2021: 417.1, 2024: 3.1}, 'Import': {2021: 404.8, 2024: 2.4} } },
    'GBR': { name: 'Storbritannien', currency: 'GBP mia.', data: { 'BNP i markedspriser': {2021: 2285.4, 2024: 1.1}, 'Privat forbrug': {2021: 1369.8, 2024: 0.6}, 'Offentligt forbrug': {2021: 508.7, 2024: 3.0}, 'Investeringer': {2021: 404.9, 2024: 1.5}, 'Lager칝ndringer': {2021: 7.0, 2024: 1.1}, 'Eksport': {2021: 666.9, 2024: -1.2}, 'Import': {2021: 672.0, 2024: 2.7} } },
    'SWE': { name: 'Sverige', currency: 'SEK mia.', data: { 'BNP i markedspriser': {2021: 5452.2, 2024: 0.7}, 'Privat forbrug': {2021: 2434.3, 2024: 0.3}, 'Offentligt forbrug': {2021: 1408.8, 2024: 1.2}, 'Investeringer': {2021: 1363.7, 2024: -1.2}, 'Lager칝ndringer': {2021: 11.0, 2024: 0.3}, 'Eksport': {2021: 2573.3, 2024: 2.4}, 'Import': {2021: 2338.8, 2024: 1.7} } },
    'TUR': { name: 'Tyrkiet', currency: 'TRY mia.', data: { 'BNP i markedspriser': {2021: 7256.1, 2024: 3.2}, 'Privat forbrug': {2021: 4008.7, 2024: 3.8}, 'Offentligt forbrug': {2021: 939.3, 2024: 0.8}, 'Investeringer': {2021: 2044.2, 2024: 3.9}, 'Lager칝ndringer': {2021: 234.5, 2024: -2.3}, 'Eksport': {2021: 2593.6, 2024: 0.9}, 'Import': {2021: 2564.2, 2024: -4.1} } },
    'USA': { name: 'USA', currency: 'USD mia.', data: { 'BNP i markedspriser': {2021: 23681.2, 2024: 2.8}, 'Privat forbrug': {2021: 16113.9, 2024: 2.8}, 'Offentligt forbrug': {2021: 3375.3, 2024: 2.5}, 'Investeringer': {2021: 5039.8, 2024: 4.3}, 'Lager칝ndringer': {2021: 12.2, 2024: 0.1}, 'Eksport': {2021: 2555.4, 2024: 3.3}, 'Import': {2021: 3415.5, 2024: 5.3} } }
};

// Variabler til spillets tilstand
let currentCountryCode = "";
let currentData = null;
let currentCurrency = "";
let userAnalysis = {};

// Initialiser dropdown
const sel = document.getElementById("countrySelect");
const sortedKeys = Object.keys(allData).sort((a,b) => allData[a].name.localeCompare(allData[b].name, 'da'));

sortedKeys.forEach(key => {
    const opt = document.createElement("option");
    opt.value = key;
    opt.text = allData[key].name;
    sel.add(opt);
});

function initGame() {
    currentCountryCode = sel.value;
    if(!currentCountryCode) return alert("V칝lg venligst et land.");

    currentData = allData[currentCountryCode].data;
    currentCurrency = allData[currentCountryCode].currency;

    // Skjul/Vis sektioner
    document.getElementById("gameArea").classList.remove("hidden");
    document.getElementById("victoryScreen").classList.add("hidden");
    showStep(1);

    renderSourceData();
    resetUI();
    setupStep1();
    setupStep2(); // Nu med alle 4 komponenter
    setupStep3();
}

function renderSourceData() {
    const container = document.getElementById("dataTableContainer");
    document.getElementById("dataCountryName").textContent = allData[currentCountryCode].name;
    
    let html = `
    <table class="data-table">
        <thead>
            <tr>
                <th>N칮gletal</th>
                <th>2021 (Basis) <br><small>${currentCurrency}</small></th>
                <th>2024 (V칝kst) <br><small>%</small></th>
            </tr>
        </thead>
        <tbody>`;
    
    const keys = ["BNP i markedspriser", "Privat forbrug", "Offentligt forbrug", "Investeringer", "Lager칝ndringer", "Eksport", "Import"];
    
    keys.forEach(key => {
        const val21 = currentData[key][2021];
        const val24 = currentData[key][2024];
        html += `
            <tr>
                <td>${key}</td>
                <td>${val21 ? val21.toLocaleString('da-DK') : '-'}</td>
                <td>${val24 ? val24.toFixed(1) + '%' : '-'}</td>
            </tr>`;
    });

    html += `</tbody></table>`;
    container.innerHTML = html;
}

function showStep(num) {
    document.getElementById("step1").classList.add("hidden");
    document.getElementById("step2").classList.add("hidden");
    document.getElementById("step3").classList.add("hidden");
    document.getElementById("step"+num).classList.remove("hidden");

    for(let i=1; i<=4; i++){
        document.getElementById("nav"+i).classList.remove("active");
        if(i < num) document.getElementById("nav"+i).classList.add("completed");
    }
    document.getElementById("nav"+num).classList.add("active");
}

function resetUI() {
    document.querySelectorAll("input").forEach(i => { i.value = ""; i.style.backgroundColor = "white"; });
    document.querySelectorAll(".feedback").forEach(d => { d.className = "feedback"; d.innerHTML = ""; });
    document.getElementById("btnNext1").disabled = true;
    document.getElementById("btnNext2").disabled = true;
    document.querySelectorAll(".currency").forEach(s => s.textContent = currentCurrency);
    document.getElementById("sumLeft").textContent = "0";
    document.getElementById("sumRight").textContent = "0";
}

// --- TRIN 1 ---
function setupStep1() {
    const leftContainer = document.getElementById("containerLeft");
    const rightContainer = document.getElementById("containerRight");
    leftContainer.innerHTML = "";
    rightContainer.innerHTML = "";

    const leftVars = ["BNP i markedspriser", "Import"];
    const rightVars = ["Privat forbrug", "Offentligt forbrug", "Investeringer", "Eksport", "Lager칝ndringer"];

    leftVars.forEach(v => createInput(v, leftContainer, 'left'));
    rightVars.forEach(v => createInput(v, rightContainer, 'right'));
}

function createInput(label, container, side) {
    const row = document.createElement("div");
    row.className = "input-row";
    const correctVal = currentData[label] && currentData[label][2021] ? currentData[label][2021] : 0;
    row.innerHTML = `<label>${label}</label><input type="number" step="0.1" data-correct="${correctVal}" data-side="${side}" oninput="updateSums()">`;
    container.appendChild(row);
}

function updateSums() {
    let sumL = 0, sumR = 0;
    document.querySelectorAll("#step1 input").forEach(inp => {
        const val = parseFloat(inp.value) || 0;
        if(inp.dataset.side === 'left') sumL += val; else sumR += val;
    });
    document.getElementById("sumLeft").textContent = sumL.toFixed(1);
    document.getElementById("sumRight").textContent = sumR.toFixed(1);
}

function checkStep1() {
    const inputs = document.querySelectorAll("#step1 input");
    let allCorrect = true;
    let sumLeft = 0, sumRight = 0;

    inputs.forEach(inp => {
        const userVal = parseFloat(inp.value);
        const correctVal = parseFloat(inp.dataset.correct);
        if(inp.dataset.side === 'left') sumLeft += (userVal || 0); else sumRight += (userVal || 0);

        if (isNaN(userVal) || Math.abs(userVal - correctVal) > 0.5) {
            inp.style.backgroundColor = "#f8d7da";
            allCorrect = false;
        } else {
            inp.style.backgroundColor = "#d4edda";
        }
    });

    const diff = Math.abs(sumLeft - sumRight);
    const fb = document.getElementById("fb1");

    if (allCorrect && diff < 1.0) {
        fb.className = "feedback success";
        fb.innerHTML = `<strong>Korrekt opstillet!</strong><br>Balance opn친et.`;
        document.getElementById("btnNext1").disabled = false;
    } else {
        fb.className = "feedback error";
        fb.innerHTML = `<strong>Fejl i balancen.</strong><br>Ubalance: ${diff.toFixed(1)}.`;
    }
}

// --- TRIN 2: V칁GTNING (OPDATERET: Alle 4 komponenter) ---
function setupStep2() {
    const tbody = document.getElementById("calcBody");
    tbody.innerHTML = "";
    
    // Vis BNP for 2021
    const bnpVal = currentData["BNP i markedspriser"][2021];
    document.getElementById("step2BNP").textContent = bnpVal.toLocaleString("da-DK");

    const comps = ["Privat forbrug", "Offentligt forbrug", "Investeringer", "Eksport"];
    
    comps.forEach(comp => {
        const val = currentData[comp][2021];
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${comp}</td>
            <td>${val.toLocaleString("da-DK")}</td>
            <td><input type="number" class="calc-input" data-comp="${comp}" step="0.1"> %</td>
        `;
        tbody.appendChild(row);
    });
}

function checkStep2() {
    const inputs = document.querySelectorAll("#step2 .calc-input");
    const bnpVal = currentData["BNP i markedspriser"][2021];
    let allCorrect = true;
    let errorMsg = "";

    inputs.forEach(inp => {
        const compName = inp.dataset.comp;
        const val = currentData[compName][2021];
        const correctShare = (val / bnpVal) * 100;
        const userVal = parseFloat(inp.value);

        if (isNaN(userVal) || Math.abs(userVal - correctShare) > 1.5) { // 1.5% margin
            inp.style.backgroundColor = "#f8d7da";
            allCorrect = false;
        } else {
            inp.style.backgroundColor = "#d4edda";
        }
    });

    const fb = document.getElementById("fb2");
    if (allCorrect) {
        fb.className = "feedback success";
        fb.innerHTML = `<strong>Perfekt!</strong> Du har nu overblik over, hvor meget hver komponent fylder i 칮konomien.`;
        document.getElementById("btnNext2").disabled = false;
    } else {
        fb.className = "feedback error";
        fb.innerHTML = `Nogle af beregningerne er ikke helt pr칝cise (tjek formlen: Komponent / BNP * 100).`;
    }
}

// --- TRIN 3: V칁KSTBIDRAG ---
function setupStep3() {
    const bnpGrowth = currentData["BNP i markedspriser"][2024];
    document.getElementById("growthBNP").textContent = bnpGrowth.toFixed(1);

    const tbody = document.getElementById("tableBody");
    tbody.innerHTML = "";
    userAnalysis = {};

    const comps = ["Privat forbrug", "Offentligt forbrug", "Investeringer", "Eksport"];
    
    const options = [
      { label: "Positivt", value: "Positivt" },
      { label: "Neutralt", value: "Neutralt" },
      { label: "Mindre bidrag", value: "Mindre bidrag" },
      { label: "Negativt", value: "Negativt" }
    ];

    comps.forEach(comp => {
        const growth = currentData[comp][2024];
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${comp}</td><td><strong>${growth.toFixed(1)}%</strong></td>`;

        const tdBtn = document.createElement("td");
        const btnGroup = document.createElement("div");
        btnGroup.className = "btn-group";
        
        options.forEach(opt => {
            const btn = document.createElement("button");
            btn.className = "btn-option";
            btn.textContent = opt.label;
            btn.onclick = () => {
                Array.from(btnGroup.children).forEach(b => b.classList.remove("selected"));
                btn.classList.add("selected");
                userAnalysis[comp] = opt.value;
            };
            btnGroup.appendChild(btn);
        });
        tdBtn.appendChild(btnGroup);
        tr.appendChild(tdBtn);
        tbody.appendChild(tr);
    });
}

function checkStep3() {
    const bnpGrowth = currentData["BNP i markedspriser"][2024];
    const comps = ["Privat forbrug", "Offentligt forbrug", "Investeringer", "Eksport"];
    let errors = [];

    comps.forEach(comp => {
        const userChoice = userAnalysis[comp];
        if(!userChoice) { errors.push(`Mangler vurdering for ${comp}.`); return; }

        const growth = currentData[comp][2024];
        let correctType = "";

        // Logik: Negativt (<0), Neutralt (ca. BNP), Positivt (>BNP+0.1), Mindre bidrag (0-BNP)
        // Logik: Negativt (<0), Neutralt (ca. BNP), Positivt (>BNP+0.1), Mindre bidrag (0-BNP)
if (growth < 0) {
    correctType = "Negativt";
} 
else if (Math.abs(growth - bnpGrowth) <= 0.1) {
    correctType = "Neutralt";
} 
else if (growth > bnpGrowth + 0.1) {
    correctType = "Positivt";
} 
else {
    correctType = "Mindre bidrag";
}

        if (userChoice !== correctType) {
    let reason = "";
    if (correctType === "Positivt") reason = "stiger mere end BNP og tr칝kker gennemsnittet op"; // Lille tekstjustering for klarhed
    else if (correctType === "Mindre bidrag") reason = "er positivt, men ligger under BNP-snittet";
    else if (correctType === "Neutralt") reason = "f칮lger BNP-niveauet";
    else reason = "er negativt og tr칝kker v칝ksten direkte ned";

    errors.push(`${comp}: Du valgte '${userChoice}'. Korrekt: <strong>${correctType}</strong> (v칝kst: ${growth.toFixed(1)}%). Begrundelse: Tallet ${reason}.`);
}
    });

    const fb = document.getElementById("fb3");
fb.style.display = "block";
    if(errors.length === 0) {
        fb.className = "feedback success";
        // Her laver vi knappen til Trin 4 i stedet for victory
        fb.innerHTML = "<strong>Fremragende analyse!</strong> Du har korrekt vurderet alle komponenternes bidrag.<br>";
        fb.innerHTML += '<button onclick="startStep4()" style="margin-top:10px; background-color:#2980b9;">G친 til Trin 4: Kausalitet &rarr;</button>';
    } else {
        fb.className = "feedback error";
        fb.innerHTML = "<strong>Fejl i analysen:</strong><br><ul style='text-align:left;'>" + errors.map(e => `<li>${e}</li>`).join("") + "</ul>";
    }
}

function showVictory() {
    document.getElementById("step3").classList.add("hidden");
    document.getElementById("finalCountryName").textContent = allData[currentCountryCode].name;
    document.getElementById("victoryScreen").classList.remove("hidden");
}
// --- TRIN 4 LOGIK ---

function startStep4() {
    showStep(4);
    setupStep4();
}

function setupStep4() {
    // Nulstil UI
    document.getElementById("s4_part1").classList.remove("hidden");
    document.getElementById("s4_part2").classList.add("hidden");
    document.getElementById("s4_part3").classList.add("hidden");
    
    document.querySelectorAll(".feedback").forEach(f => { f.style.display = "none"; f.innerHTML = ""; });
    
    // Vis BNP tallet
    const bnpGrowth = currentData["BNP i markedspriser"][2024];
    document.querySelectorAll(".bnp-display").forEach(el => el.textContent = bnpGrowth.toFixed(1) + "%");

    // Klarg칮r Del 3
    renderCausalChains();
}

// DEL 1: SITUATION
function checkStep4_Part1() {
    const bnp = currentData["BNP i markedspriser"][2024];
    const userChoice = document.getElementById("s4_situationSelect").value;
    const fb = document.getElementById("fb4_1");
    
    let correctStatus = "";
    if (bnp < 1) correctStatus = "lav"; 
    else if (bnp >= 1 && bnp <= 2) correctStatus = "stabil";
    else correctStatus = "h칮j";

    let isAcceptable = (userChoice === correctStatus);
    if (bnp < 0 && userChoice === "krise") isAcceptable = true;
    if (bnp > 3 && userChoice === "overophedning") isAcceptable = true;

    fb.style.display = "block";
    if (isAcceptable) {
        fb.className = "feedback success";
        fb.innerHTML = "<strong>Korrekt!</strong> Du har identificeret den 칮konomiske situation.";
        document.getElementById("s4_part2").classList.remove("hidden");
        setTimeout(() => document.getElementById("s4_part2").scrollIntoView({behavior: "smooth"}), 100);
    } else {
        fb.className = "feedback error";
        fb.innerHTML = `Ikke helt. Husk: < 1% er Lavkonjunktur, 1-2% er Stabil, > 2% er H칮jkonjunktur.`;
    }
}

// DEL 2: M칀LS칁TNING
function checkStep4_Part2() {
    const bnp = currentData["BNP i markedspriser"][2024];
    const choice = document.getElementById("s4_goalSelect").value;
    const reason = document.getElementById("s4_goalReason").value;
    const fb = document.getElementById("fb4_2");

    const goalMet = bnp >= 1; 
    const correctChoice = goalMet ? "yes" : "no";
    const correctReason = goalMet ? "high" : "low"; 

    fb.style.display = "block";
    if (choice === correctChoice && reason === correctReason) {
        fb.className = "feedback success";
        fb.innerHTML = "<strong>Korrekt!</strong> Du har b친de vurderet m친let og 친rsagen rigtigt.";
        document.getElementById("s4_part3").classList.remove("hidden");
        setTimeout(() => document.getElementById("s4_part3").scrollIntoView({behavior: "smooth"}), 100);
    } else {
        fb.className = "feedback error";
        fb.innerHTML = "Forkert. Tjek om v칝ksten er over eller under 1%, og v칝lg den begrundelse der passer til tallet.";
    }
}

// DEL 3: KAUSALK칁DER
function renderCausalChains() {
    const container = document.getElementById("causalBuilderContainer");
    container.innerHTML = "";

    const logicTexts = {
        "Privat forbrug": {
            high: { 
                desc: "Husholdningernes eftersp칮rgsel bidrager til den 칮gede v칝kst, fordi den leder til en 칮get produktion i virksomhederne, hvilket leder til flere ansatte. Dette mindsker arbejdsl칮sheden.",
                chain: "Eftersp칮rgsel 칮ges -> Produktion 칮ges -> Behov for flere ansatte -> Lavere arbejdsl칮shed"
            },
            mid: { 
                desc: "Husholdningernes eftersp칮rgsel har et mindre bidrag til den 칮konomiske v칝kst.",
                chain: "Eftersp칮rgsel 칮ges lidt -> skaber en hvis produktion -> muligt behov for at ans칝tte flere -> Mulig 칝ndring i arbejdsl칮sheden"
            },
            neg: { 
                desc: "Et fald i husholdningernes eftersp칮rgsel tr칝kker den 칮konomiske v칝kst ned.",
                chain: "Eftersp칮rgslen falder -> Et fald i produktionen -> Flere afskediges -> Stigning i arbejdsl칮sheden"
            }
        },
        "Investeringer": {
            high: {
                desc: "Statens 칮gede investeringer bidrager til den 칮gede v칝kst, fordi den leder til en 칮get produktion i virksomhederne, hvilket leder til flere ansatte. Dette mindsker arbejdsl칮sheden.",
                chain: "Eftersp칮rgsel 칮ges -> Produktion 칮ges -> Behov for flere ansatte -> Lavere arbejdsl칮shed"
            },
            mid: {
                desc: "Investeringerne har et mindre bidrag til den 칮konomiske v칝kst.",
                chain: "Investeringer 칮ges lidt -> skaber en hvis produktion -> muligt behov for at ans칝tte flere -> Mulig 칝ndring i arbejdsl칮sheden"
            },
            neg: {
                desc: "Et fald i statens off. investeringer tr칝kker den 칮konomiske v칝kst ned.",
                chain: "Eftersp칮rgslen falder -> Et fald i produktionen -> Flere afskediges -> Stigning i arbejdsl칮sheden"
            }
        },
        "Eksport": {
            high: {
                desc: "Virksomhedernes salg af varer til udlandet bidrager til den 칮gede v칝kst, fordi den leder til en 칮get produktion i virksomhederne, hvilket leder til flere ansatte. Dette mindsker arbejdsl칮sheden.",
                chain: "Eftersp칮rgsel 칮ges -> Produktion 칮ges -> Behov for flere ansatte -> Lavere arbejdsl칮shed"
            },
            mid: {
                desc: "Eksporten har et mindre bidrag til den 칮konomiske v칝kst.",
                chain: "Eksporten 칮ges lidt -> skaber en hvis produktion -> muligt behov for at ans칝tte flere -> Mulig 칝ndring i arbejdsl칮sheden"
            },
            neg: {
                desc: "En lavere udenlandsk eftersp칮rgsel efter varer tr칝kker den 칮konomiske v칝kst ned.",
                chain: "Eftersp칮rgslen falder -> Et fald i produktionen -> Flere afskediges -> Stigning i arbejdsl칮sheden"
            }
        },
        "Offentligt forbrug": {
            high: {
                desc: "Statens 칮gede udgifter til forsvar, sundhed og uddannelse bidrager til den 칮gede v칝kst, fordi den leder til en 칮get produktion i virksomhederne, hvilket leder til flere ansatte. Dette mindsker arbejdsl칮sheden.",
                chain: "Eftersp칮rgsel 칮ges -> Produktion 칮ges -> Behov for flere ansatte -> Lavere arbejdsl칮shed"
            },
            mid: {
                desc: "Offentligt forbrug har et mindre bidrag til den 칮konomiske v칝kst.",
                chain: "Offentligt forbrug er positivt -> skaber en hvis produktion -> muligt behov for at ans칝tte flere -> Mulig 칝ndring i arbejdsl칮sheden"
            },
            neg: {
                desc: "Statens mindskede udgifter til offentligt forbrug tr칝kker den 칮konomiske v칝kst ned.",
                chain: "Eftersp칮rgslen falder -> Et fald i produktionen -> Flere afskediges -> Stigning i arbejdsl칮sheden"
            }
        }
    };

    const comps = ["Privat forbrug", "Investeringer", "Eksport", "Offentligt forbrug"];
    const bnpGrowth = currentData["BNP i markedspriser"][2024];

    comps.forEach((key, index) => {
        const val = currentData[key][2024];
        
        let correctCat = "";
        if (val < 0) correctCat = "neg";
        else if (val > bnpGrowth) correctCat = "high";
        else correctCat = "mid";

        const options = logicTexts[key];
        
        let descOpts = [
            {val: "high", text: options.high.desc},
            {val: "mid", text: options.mid.desc},
            {val: "neg", text: options.neg.desc}
        ].sort(() => Math.random() - 0.5);

        let chainOpts = [
            {val: "high", text: options.high.chain},
            {val: "mid", text: options.mid.chain},
            {val: "neg", text: options.neg.chain}
        ].sort(() => Math.random() - 0.5);

        container.innerHTML += `
        <div class="card" id="card_${index}" data-correct="${correctCat}" style="padding:15px; border:1px solid #ddd; margin-bottom:15px;">
            <h4 style="margin-top:0;">${key} (${val.toFixed(1)}%)</h4>
            
            <div style="margin-bottom:10px;">
                <label style="font-size:0.9em; font-weight:bold;">1. Hvordan p친virker dette v칝ksten?</label><br>
                <select id="desc_${index}" class="chain-select" style="width:100%; padding:5px; margin-top:5px; font-size:14px;">
                    <option value="" disabled selected>-- V칝lg beskrivelse --</option>
                    ${descOpts.map(o => `<option value="${o.val}">${o.text}</option>`).join('')}
                </select>
            </div>
            
            <div>
                <label style="font-size:0.9em; font-weight:bold;">2. V칝lg kausalk칝den:</label><br>
                <select id="chain_${index}" class="chain-select" style="width:100%; padding:5px; margin-top:5px; font-size:14px;">
                    <option value="" disabled selected>-- V칝lg k칝de --</option>
                    ${chainOpts.map(o => `<option value="${o.val}">${o.text}</option>`).join('')}
                </select>
            </div>
        </div>`;
    });
}

function checkStep4_Part3() {
    const comps = ["Privat forbrug", "Investeringer", "Eksport", "Offentligt forbrug"];
    let allCorrect = true;

    comps.forEach((key, index) => {
        const card = document.getElementById(`card_${index}`);
        const correctCat = card.dataset.correct;
        
        const descSel = document.getElementById(`desc_${index}`);
        const chainSel = document.getElementById(`chain_${index}`);

        if(descSel.value !== correctCat) {
            descSel.style.border = "2px solid #e74c3c";
            allCorrect = false;
        } else {
            descSel.style.border = "2px solid #2ecc71";
        }

        if(chainSel.value !== correctCat) {
            chainSel.style.border = "2px solid #e74c3c";
            allCorrect = false;
        } else {
            chainSel.style.border = "2px solid #2ecc71";
        }
    });

    const fb = document.getElementById("fb4_3");
    fb.style.display = "block";
    
    if(allCorrect) {
        fb.className = "feedback success";
        fb.innerHTML = "<strong>Fremragende!</strong> Du har analyseret alle sammenh칝nge korrekt.";
        setTimeout(showVictory, 2000); 
    } else {
        fb.className = "feedback error";
        fb.innerHTML = "Der er fejl i dine valg. <br>Husk reglerne: Negativ v칝kst tr칝kker ned, lav v칝kst giver mindre bidrag, og h칮j v칝kst (over BNP) er en driver.";
    }
}
</script>

</body>
</html>


